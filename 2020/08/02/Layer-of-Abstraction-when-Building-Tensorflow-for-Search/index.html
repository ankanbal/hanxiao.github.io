<!DOCTYPE html><html lang="en"><style>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,header,main{display:block}a{background-color:transparent}h1{font-size:2em;margin:.67em 0}img{border:0}body,html{width:100%;height:100%}body{margin:0;color:#34495e;font-size:18px;line-height:1.6;background-color:#fff;font-family:sourcesanspro,'Helvetica Neue',Arial,sans-serif}ul.nav{margin:0;padding:0;list-style-type:none}ul{margin:1rem 0}a{color:#2c3e50;text-decoration:none}.flag-icon{height:25px;width:25px;display:inline;border-radius:50%;vertical-align:sub}.icon_item{padding-left:5px!important;padding-right:5px!important}header{min-height:60px}header .logo-link{float:left}header .nav{float:right;left:80px}header .logo-link img{height:60px}header .nav-list-item{display:inline-block;padding:19px 10px}header .nav-list-item a{line-height:1.4}@media screen and (max-width:900px){header .nav-list-item a{font-size:15px}}@media screen and (min-width:900px){header .nav-list-item a{font-size:18px}}.post{padding-top:1em}.post-block .post-title{margin:.65em 0;color:#2c3e50;font-size:1.5em}.post-block .post-info{color:#7f8c8d}.post-block .post-info .read-time{text-align:right}.post-content h2,.post-content h4{position:relative;margin:1em 0}.post-content h2 :before,.post-content h4 :before{content:"#";color:#42b983;position:absolute;left:-.7em;top:-4px;font-size:1.2em;font-weight:700}.post-content h4 :before{content:">"}.post-content h2{font-size:22px}.post-content h4{font-size:18px}.post-content a{color:#42b983;word-break:break-all}main.container{margin:2em 10px}@media screen and (min-width:900px){.wrap{width:900px;margin:0 auto}header{padding:20px 60px}}@media screen and (max-width:900px){.wrap{width:100%}header{min-height:50px;padding:2px 2px;position:fixed;z-index:10000;border-radius:15px;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}header a.logo-link,header ul.nav.nav-list{float:none;display:inline;text-align:center}header li.nav-list-item{padding:10px 5px}header .logo-link img{height:20px;vertical-align:sub}header .flag-icon{height:20px;width:20px}header{background-color:rgba(255,255,255,.9)}@supports ((-webkit-backdrop-filter:blur(2em)) or (backdrop-filter:blur(2em))){header{background-color:rgba(255,255,255,.3);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}}main.container{padding-top:2em}main.container{margin:0 20px}.post-content h2,.post-content h4{max-width:300px;left:15px}}@font-face{font-family:sourcesanspro;src:url(/font/sourcesanspro.woff2) format("woff2"),url(/font/sourcesanspro.woff) format("woff");font-weight:400;font-style:normal}</style><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Layer of Abstraction When Building "Tensorflow" for Search ¬∑ Han Xiao Tech Blog - Neural Search, AI, Engineering</title><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@hxiao"><meta name="twitter:creator" content="@hxiao"><meta name="description" content="Since Feb. 2020, I started a new venture called Jina AI. Our mission is to build an open-source neural search ecosystem for businesses and developers, ... ¬∑ Han Xiao"><meta property="og:title" content="Layer of Abstraction When Building &quot;Tensorflow&quot; for Search ¬∑ Han Xiao Tech Blog - Neural Search, AI, Engineering"><meta property="og:description" content="Since Feb. 2020, I started a new venture called Jina AI. Our mission is to build an open-source neural search ecosystem for businesses and developers, ... ¬∑ Han Xiao"><meta property="og:url" content="https://hanxiao.io/2020/08/02/Layer-of-Abstraction-when-Building-Tensorflow-for-Search/"><meta property="og:image" content="https://hanxiao.io/2020/08/02/Layer-of-Abstraction-when-Building-Tensorflow-for-Search//blog-abstraction-banner.jpg"><meta property="og:type" content="article"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/wechaticon.png"><link rel="alternate" type="application/rss+xml" title="Han Xiao Tech Blog - Neural Search, AI, Engineering" href="https://hanxiao.io/atom.xml"><link rel="preload" href="/css/apollo.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="/css/apollo.css"></noscript><script>!function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var o=loadCSS.relpreload={};if(o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},!o.support()){o.poly();var t=n.setInterval(o.poly,500);n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this)</script><link rel="search" type="application/opensearchdescription+xml" href="https://hanxiao.io/atom.xml" title="Han Xiao Tech Blog - Neural Search, AI, Engineering"></head><body><div class="reading-progress-bar"></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/wechaticon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/subscribe/" target="_self" class="nav-list-link">SUBSCRIBE</a></li><li class="nav-list-item icon_item"><a href="https://www.linkedin.com/in/hxiao87" target="_blank" class="nav-list-link"><img src="/linkedin.svg" alt="linkedin" class="flag-icon"></a></li><li class="nav-list-item icon_item"><a href="https://twitter.com/hxiao" target="_blank" class="nav-list-link"><img src="/twitter.svg" alt="twitter" class="flag-icon"></a></li><li class="nav-list-item icon_item"><a href="https://github.com/hanxiao" target="_blank" class="nav-list-link"><img src="/github.svg" alt="github" class="flag-icon"></a></li><li class="nav-list-item icon_item"><a href="https://www.youtube.com/c/jina-ai" target="_blank" class="nav-list-link"><img src="/youtube.svg" alt="youtube" class="flag-icon"></a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Layer of Abstraction When Building "Tensorflow" for Search</h1><div class="post-info">Aug 2, 2020 by &nbsp;&nbsp;&nbsp;<img src="/myavatar.png" alt="logo" width="18px" height="18px" style="vertical-align:sub">&nbsp;<a href="https://www.linkedin.com/company/jinaai" target="_blank" class="nav-list-link">Han Xiao - Founder & CEO @ Jina AI üëê<i style="font-size:smaller"> We are hiring!</i></a></div><div class="post-info"><div class="read-time">‚ó∑&nbsp;&nbsp;&nbsp; 11 min read</div></div><div class="post-content"><h2><span id="background">Background</span></h2><p>Since Feb. 2020, I started a new venture called <a href="https://www.linkedin.com/company/jinaai" target="_blank" rel="noopener">Jina AI</a>. Our mission is to build an open-source neural search ecosystem for businesses and developers, allowing everyone to search for information in all kinds of data with high availability and scalability.<a id="more"></a> At the core of this ecosystem is <a href="https://github.com/jina-ai/jina" target="_blank" rel="noopener">Jina: a framework</a> that enables one to bootstrap cloud-native neural search in minutes, which otherwise would take months.</p><p>We have received quite some attention from the community since Jina came out of stealth in May. Early adopters include users of my previous projects bert-as-service, GNES, and Fashion-MNIST. Many of them expect Jina to be a one-liner solution to their problems, just like bert-as-service or other trending AI projects. Soon they realized that Jina is not a one-liner: it is a pretty versatile framework with a relatively steep learning curve. Perhaps our ambition is beyond their initial expectations, or perhaps the overwhelming documentation makes people feel nowhere to start with. Either way, one frequent question I receive is: <em>what is Jina?</em></p><p>The purpose of this post is not only answering this question but also sharing our understanding of <strong>abstraction</strong> when building frameworks like Jina:</p><ul><li>Many computer science problems can be solved by adding another level of abstraction, especially when we want to improve the usability.</li><li>Unlike one-liner and sugary API, Jina is shipped with multiple layers of abstractions; each layer targets a particular developer group.</li><li>Features need to be implemented at the correct abstraction layer to solve the problem effectively.</li></ul><h4><span id="table-of-contents">Table of Contents</span></h4><ul><li><a href="#jina-is-tensorflow-for-search">Jina is ‚ÄúTensorflow‚Äù for Search</a></li><li><a href="#layer-of-abstraction">Layer of Abstraction</a></li><li><a href="#engineering-challenges">Engineering Challenges</a><ul><li><a href="#implementing-the-right-feature-at-the-correct-layer">Implementing the right feature at the correct layer</a></li><li><a href="#managing-and-guiding-community-expectations">Managing and guiding community expectations</a></li><li><a href="#refactoring-the-documentation-accordingly">Refactoring the documentation accordingly</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li></ul><h2><span id="jina-is-tensorflow-for-search">Jina is ‚ÄúTensorflow‚Äù for Search</span></h2><img src="/2020/08/02/Layer-of-Abstraction-when-Building-Tensorflow-for-Search/e8b561b2.png"><p>I often use the analogy <em>‚ÄúTensorflow‚Äù for search</em> to explain what Jina is. Jina sits one layer above the universal deep learning framework (e.g., Tensorflow, Pytorch, Mindspore); it provides the infrastructure for building AI-powered search applications. So the next time you develop a multi-/cross-modalities search app (question answering, image/video/audio search), Jina will be your go-to <em>‚Äúprogramming language‚Äù</em>. It helps you get the job done quickly and beautifully by providing you first-class support on AI models and rich cloud-native features.</p><img src="/2020/08/02/Layer-of-Abstraction-when-Building-Tensorflow-for-Search/ff7f8875.png"><p>Every era has its design pattern, and this is what we observed from the evolution of programming languages. The same goes for the search system. Jina is built on the fact that today‚Äôs search queries are beyond simple keywords, and the underlying algorithms are often AI-centric. Comparing to legacy design patterns in the market, Jina provides modern and intuitive idioms for building neural search systems in production.</p><p>So, we are building Jina as a framework. Now we need to talk about the layer of abstraction in Jina.</p><h2><span id="layer-of-abstraction">Layer of Abstraction</span></h2><blockquote><p>There‚Äôs no problem in Computer Science that can‚Äôt be solved by adding another level of indirection (/abstraction) to it.</p></blockquote><p>Abstraction is a commonly used in software design. By hiding the complexity and the real implementation in the lower level, higher-level API can often provide more readable code and shorter development time. One radical example is the ‚Äúone-liner (or syntactic sugar or sugary API)‚Äù design, as we see in many trending AI projects. It provides user a single deceptively powerful entrypoint such as <code>translate(&#39;hello world&#39;, target_lang=&#39;de&#39;)</code>. While the ideal way for abstraction is to keep the versatility promised at lower levels, one-liner trades off much of the primitive versatility for exchanging extreme usability. However, despite being eye catching on social shares (<a href="https://carbon.now.sh/" target="_blank" rel="noopener">thanks to Carbon.sh</a>), one-liners often have limited use cases and are not production-ready.</p><img src="/2020/08/02/Layer-of-Abstraction-when-Building-Tensorflow-for-Search/abstraction.png"><p>Jina follows a progressive way when doing abstraction. Unlike one-liners, Jina is shipped with multiple layers of abstractions, each layer targets a particular developer group. As a consequence, users can choose different levels of API to interact with Jina and accomplish the task. Designing and architecting Jina becomes finding what the essential complexity is, and then moving it around.</p><p>For example, Jina started with the concept of <code>Executor</code> to abstract the complexity behind AI models and unify their interfaces. This abstraction allows AI engineers to chain and compose models as they manipulate variables. AI models can be read from a YAML file and be invoked via simple interface, such as <code>.encode()</code>, <code>.index()</code>, <code>.add()</code>, <code>.query()</code>, <code>.segment()</code>. Later, <code>Driver</code> was added to grant <code>Executor</code> the read &amp; write abilities on Protobuf message, while keeping <code>Executor</code> data-agnostic. Furthermore, with the help of <code>Pea</code> and <code>Pod</code>, developers can quickly deploy <code>Executor</code> in a <em>decentralized</em> way. They can parallelize it, containerize it, run it as an independent process or use it as a service. On top of that, <code>Flow</code> API provides a high level interface for orchestrating all <code>Pod</code> to achieve a certain task. In the end Jina exposes API at different levels, allowing developers to choose their niches. We see this design pattern appears in other frameworks as well. In Tensorflow, developers can use micro-level neural network operations in <code>tf.nn</code>, layers API in <code>tf.keras.layers</code> and macro-level network models in <code>tf.estimator</code>.</p><img src="/2020/08/02/Layer-of-Abstraction-when-Building-Tensorflow-for-Search/jinaabstraction.png"><h2><span id="engineering-challenges">Engineering Challenges</span></h2><div class="quiz"><br><ul><br><li>Implementing the right feature at the correct layer</li><br><li>Managing and guiding community expectations</li><br><li>Refactoring the documentation regularly</li><br></ul><br></div><h4><span id="implementing-the-right-feature-at-the-correct-layer">Implementing the right feature at the correct layer</span></h4><p>With an architecture like Jina, the biggest challenge is implementing the right feature at the correct layer. Some features are in the very high-level hence they must be postponed until the low-level is ready. Some features have very vague relations to the end-user experience, yet they are enablers for many functionalities on the higher level. Hence, they have to be implemented right now. Some features are simply out of the scope of the product roadmap; they have to be delegated to third-party or implemented in another product.</p><p>The biggest decision often is not about what this API layer does do, but instead what it doesn‚Äôt do.</p><p>One example is the logging in Jina. Some users argue that the log printed in the console is overwhelming and hard to comprehend. Features such as log prettify, grouping and persistence are requested. Though we can squeeze rich debug info and prettify the console‚Äôs logs, this only works to a certain level. Users may soon realize they need extra customization and more professional log management when using Jina in production, making previously added features frivolous and wasteful. As a solution, Jina implemented <a href="https://github.com/jina-ai/jina/tree/master/jina/logging" target="_blank" rel="noopener">a logger interface</a> that can be used from low-level <code>Executor</code> up to high level <code>Flow</code>. The logger interface enables the emission of raw logs in JSON format to the network via Server Sent Events. One of our other products, <a href="https://github.com/jina-ai/dashboard" target="_blank" rel="noopener">Jina Dashboard</a> then takes over the job. The dashboard subscribes to the log stream and does all the processing, grouping and analyzing work in Javascript.</p><p>Another example is <a href="https://github.com/jina-ai/cookiecutter-jina" target="_blank" rel="noopener"><code>cookiecutter-jina</code></a>. This project aims to help developers to create Jina projects from predefined templates. It is a pretty high-level feature that sits on top of Flow API. However, due to the nature of complexity in Jina, we quickly realized that maintaining cookiecutter with a simple markup language (<a href="https://jinja.palletsprojects.com/en/2.11.x/" target="_blank" rel="noopener">Jinja</a>) isn‚Äôt the best idea. Today we are working on other solutions including GUI ones to help developers bootstrap a new project quickly.</p><h4><span id="managing-and-guiding-community-expectations">Managing and guiding community expectations</span></h4><p>The community often wants to get things done as quickly as possible. While the framework developers share the same ultimate goal, they have to take steps by first building lower layers steadily and robustly. When developing the framework as an open-source project, aligning the community expectation and being transparent on the roadmap is crucial.</p><h4><span id="refactoring-the-documentation-accordingly">Refactoring the documentation accordingly</span></h4><p>When multiple abstractions are exposed, the concern about the complexity and length of documentation arises. The documentation of each API layer needs to be self-contained and explain its connection to the upper and lower levels. This extends the effort required to maintain and correct documentation throughout the lifecycle.</p><p>A good design of documentation will provide the correct entrypoint for each targeted user group, guiding them to the information they needed. This means not only optimizing on the UX level, but also showing/hiding/emphasizing particular sections, changing the narrative accordingly. Just like software, documentation is a continuous effort and has to be revisited and refactored from time to time.</p><img src="/2020/08/02/Layer-of-Abstraction-when-Building-Tensorflow-for-Search/blog-abstraction-illu3.png"><h2><span id="conclusion">Conclusion</span></h2><p>With so many variables at play, complexity and abstraction is a natural part of framework design. In Jina, our everyday job includes rethinking complexity, decomposing it, hiding it, and moving it around; to ensure that features are more consumable and more apt for new developers and users.</p><p>I hope these thoughts on the abstraction could help the community to understand Jina better and shed light when people try to develop their own AI framework. If you want to see how Jina evolves and carries out those philosophical ideas into practice, make sure to <a href="https://github.com/jina-ai/jina/" target="_blank" rel="noopener">check out our Github repository <code>jina-ai/jina</code> and give it a star</a>. If you are interested in working with me, please send your CV to <a href="mailto:career@jina.ai" target="_blank" rel="noopener">career@jina.ai</a>. Let‚Äôs build the neural search ecosystem together in open source!</p></div></article></div></main><footer><div class="paginator"><a href="/2020/08/06/Engineering-All-Hands-in-Public/" class="prev">&nbsp;‚ùÆ&nbsp;&nbsp;Engineering All Hand...</a><a href="/2020/02/18/I-Quitted-Tencent-AI-and-Raised-M-to-Build-the-Next-Neural-Search-Company-in-Opensource/" class="next">I Left Tencent AI an...&nbsp;&nbsp;‚ùØ&nbsp;</a></div><div id="gitment_thread"></div><div class="copyright"><p>¬© 2017 - 2020 <a href="https://hanxiao.io">Han Xiao</a>. Opinions are solely my own. <img src="/by-nc-sa.svg" alt="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License." class="image"></p></div></footer></div><link rel="stylesheet" href="/css/post/katex.min.css"><link rel="stylesheet" href="/css/post/gitment.css"><script src="/js/katex.min.js"></script><script src="/js/auto-render.min.js"></script><script>renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})</script><script src="/js/gitment.browser.js"></script><script src="/js/gitment.loader.js"></script><script src="/js/jquery-3.4.1.min.js"></script><script src="/js/reading_progress.min.js"></script><script async src="https://www.google-analytics.com/analytics.js"></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-52114253-1","auto"),ga("send","pageview")</script></body></html>